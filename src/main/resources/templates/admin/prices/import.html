<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Import Prices</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .price-up { color: #dc3545; font-weight: bold; }
        .price-down { color: #198754; font-weight: bold; }
        .price-same { color: #6c757d; }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2>üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω —Ç–æ–≤–∞—Ä–æ–≤</h2>

    <div class="card mb-4">
        <div class="card-body">
            <form method="post" th:action="@{/admin/prices/import}"
                  enctype="multipart/form-data" class="row g-3">

                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />

                <div class="col-auto">
                    <input type="file" name="file" accept=".xlsx,.xls"
                           class="form-control" required>
                </div>

                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">–ò–º–ø–æ—Ä—Ç</button>
                </div>

            </form>

            <small class="text-muted">
                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã Excel (.xlsx, .xls). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB
            </small>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
    <div th:if="${error}" class="alert alert-danger">
        <i class="bi bi-exclamation-triangle"></i>
        <span th:text="${error}"></span>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–º–ø–æ—Ä—Ç–∞ -->
    <div th:if="${result}" class="card">
        <div class="card-header">
            <h5 class="mb-0">–†–µ–∑—É–ª—å—Ç–∞—Ç –∏–º–ø–æ—Ä—Ç–∞</h5>
            <small th:text="${result.filename} + ' ‚Ä¢ ' + ${result.importedAt}"></small>
        </div>

        <div class="card-body">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body text-center">
                            <h4 th:text="${result.updatedCount}">0</h4>
                            <small>–û–±–Ω–æ–≤–ª–µ–Ω–æ</small>
                        </div>
                    </div>
                </div>
<!--                <div class="col-md-3">-->
<!--                    <div class="card bg-warning text-white">-->
<!--                        <div class="card-body text-center">-->
<!--                            <h4 th:text="${result.skippedCount}">0</h4>-->
<!--                            <small>–ü—Ä–æ–ø—É—â–µ–Ω–æ</small>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
                <div class="col-md-3">
                    <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                            <h4 th:text="${result.notFoundArticles.size()}">0</h4>
                            <small>–ù–µ –Ω–∞–π–¥–µ–Ω–æ</small>
                        </div>
                    </div>
                </div>
<!--                <div class="col-md-3">-->
<!--                    <div class="card bg-info text-white">-->
<!--                        <div class="card-body text-center">-->
<!--                            <h4 th:text="${result.priceChanges.size()}">0</h4>-->
<!--                            <small>–ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω</small>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
            </div>

            <!-- –ù–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã -->
            <div th:if="${!result.notFoundArticles.isEmpty()}" class="mb-4">
                <h6 class="text-danger">
                    <i class="bi bi-exclamation-triangle"></i>
                    –ê—Ä—Ç–∏–∫—É–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã:
                </h6>
                <div class="alert alert-warning">
                    <span th:each="article, stat : ${result.notFoundArticles}">
                        <span th:text="${article}"></span>
                        <span th:unless="${stat.last}">, </span>
                    </span>
                </div>
            </div>

            <!-- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω -->
<!--            <div th:if="${!result.priceChanges.isEmpty()}">-->
<!--                <h6>–ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω:</h6>-->
<!--                <div class="table-responsive">-->
<!--                    <table class="table table-sm">-->
<!--                        <thead>-->
<!--                        <tr>-->
<!--                            <th>–ê—Ä—Ç–∏–∫—É–ª</th>-->
<!--                            <th>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞</th>-->
<!--                            <th>–ù–æ–≤–∞—è —Ü–µ–Ω–∞</th>-->
<!--                            <th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th>-->
<!--                        </tr>-->
<!--                        </thead>-->
<!--                        <tbody>-->
<!--                        <tr th:each="change : ${result.priceChanges}">-->
<!--                            <td th:text="${change.sku}"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal(change.oldPrice, 1, 2)} + ' ‚ÇΩ'"></td>-->
<!--                            <td th:text="${#numbers.formatDecimal(change.newPrice, 1, 2)} + ' ‚ÇΩ'"></td>-->
<!--                            <td>-->
<!--                                    <span th:class="${change.difference.compareTo(BigDecimal.ZERO) > 0}-->
<!--                                            ? 'price-up' :-->
<!--                                            ${change.difference.compareTo(BigDecimal.ZERO) < 0}-->
<!--                                            ? 'price-down' : 'price-same'">-->
<!--                                        <span th:if="${change.difference.compareTo(BigDecimal.ZERO) > 0}">‚Üë </span>-->
<!--                                        <span th:if="${change.difference.compareTo(BigDecimal.ZERO) < 0}">‚Üì </span>-->
<!--                                        <span th:text="${#numbers.formatDecimal(change.difference.abs(), 1, 2)} + ' ‚ÇΩ'"></span>-->
<!--                                    </span>-->
<!--                            </td>-->
<!--                        </tr>-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </div>-->
<!--            </div>-->

            <!-- –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –æ—Ç—á–µ—Ç–∞ -->
            <div th:if="${result.updatedCount > 0}" class="mt-3">
                <a th:href="@{/admin/prices/export-report}"
                   class="btn btn-outline-primary">
                    <i class="bi bi-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>