<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <div th:replace="fragments/header :: head"></div>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<main class="container my-4">
  <!-- Хлебные крошки -->
  <nav class="category-breadcrumb rounded mb-4">
    <div class="container">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a th:href="@{/}" class="text-decoration-none">Главная</a></li>
        <li th:if="${category.parent}" class="breadcrumb-item">
          <a th:href="@{/category/{title}(title=${category.parent.title})}"
             class="text-decoration-none"
             th:text="${category.parent.name}">
            Родительская категория
          </a>
        </li>
        <li class="breadcrumb-item active" th:text="${category.name}">Категория</li>
      </ol>
    </div>
  </nav>

  <!-- Заголовок категории -->
  <div class="row mb-4">
    <div class="col">
      <h1 th:text="${category.name}">Название категории</h1>
      <p class="text-muted" th:if="${category.description}" th:text="${category.description}">
        Описание категории
      </p>
    </div>
  </div>

  <!-- Подкатегории (если есть) -->
  <div th:if="${not #lists.isEmpty(category.children)}" class="row mb-4">
    <div class="col">
      <h5>Подкатегории</h5>
      <div class="d-flex flex-wrap gap-2">
        <a th:each="subcat : ${category.children}"
           th:href="@{/category/{title}(title=${subcat.title})}"
           class="btn btn-outline-primary btn-sm"
           th:text="${subcat.name}">
          Подкатегория
        </a>
      </div>
    </div>
  </div>

  <!-- Фильтры и сортировка -->
  <div class="row mb-4">
    <div class="col-md-8">
      <div class="d-flex gap-2 flex-wrap">
        <select class="form-select" style="width: auto;">
          <option>Сортировка: по умолчанию</option>
          <option>По цене (сначала дешевые)</option>
          <option>По цене (сначала дорогие)</option>
          <option>По новизне</option>
        </select>
      </div>
    </div>
    <div class="col-md-4 text-end">
                <span class="text-muted" th:text="'Найдено товаров: ' + ${products.totalElements}">
                    Найдено товаров: 0
                </span>
    </div>
  </div>

  <!-- Сетка товаров -->
  <div class="row">
    <div th:each="product : ${products.content}" class="col-lg-3 col-md-4 col-sm-6 mb-4">
      <div class="card product-card h-100 border-0 shadow-sm">
        <div class="position-relative">
          <img th:if="${not #lists.isEmpty(product.images)}"
               th:src="${product.images[0].url}"
               class="card-img-top"
               alt="Product image"
               style="height: 200px; object-fit: cover;"
               th:alt="${product.images[0].alt} ?: ${product.name}">
          <img th:if="${#lists.isEmpty(product.images)}"
               src="/images/placeholder.jpg"
               class="card-img-top"
               alt="No image"
               style="height: 200px; object-fit: cover;">

          <div class="position-absolute top-0 end-0 m-2">
                            <span th:if="${!product.active}"
                                  class="badge bg-secondary">Неактивен</span>
            <span th:if="${product.active}"
                  class="badge bg-success">В наличии</span>
          </div>
        </div>

        <div class="card-body d-flex flex-column">
          <h6 class="card-title" th:text="${product.name}">Название товара</h6>
          <p class="card-text text-muted small flex-grow-1"
             th:text="${product.shortDescription} ?: 'Описание отсутствует'">
            Краткое описание товара
          </p>

          <div class="mt-auto">
            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="h5 text-primary mb-0"
                                      th:text="${product.currency + ' ' + #numbers.formatDecimal(product.price, 1, 2, 'COMMA')}">
                                    RUB 0.00
                                </span>
              <small class="text-muted" th:if="${product.sku}" th:text="${product.sku}">
                Артикул
              </small>
            </div>

            <div class="d-grid gap-2">
              <a th:href="@{/product/{title}(title=${product.title})}"
                 class="btn btn-outline-primary btn-sm">
                Подробнее
              </a>
              <button th:if="${product.active}"
                      class="btn btn-primary btn-sm"
                      onclick="addToCart(this)">
                <i class="bi bi-cart-plus"></i> В корзину
              </button>
              <button th:if="${!product.active}"
                      class="btn btn-secondary btn-sm" disabled>
                Недоступен
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Сообщение если нет товаров -->
  <div th:if="${#lists.isEmpty(products.content)}" class="text-center py-5">
    <i class="bi bi-inbox display-1 text-muted"></i>
    <h4 class="text-muted">В этой категории пока нет товаров</h4>
  </div>

  <!-- Пагинация -->
  <div th:if="${products.totalPages > 1}" class="row mt-5">
    <div class="col">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
          <!-- Первая страница -->
          <li class="page-item" th:classappend="${products.first} ? 'disabled' : ''">
            <a class="page-link"
               th:href="@{/category/{title}(title=${category.title}, page=0)}">
              <i class="bi bi-chevron-double-left"></i>
            </a>
          </li>

          <!-- Предыдущая страница -->
          <li class="page-item" th:classappend="${products.first} ? 'disabled' : ''">
            <a class="page-link"
               th:href="@{/category/{title}(title=${category.title}, page=${products.number - 1})}">
              <i class="bi bi-chevron-left"></i>
            </a>
          </li>

          <!-- Номера страниц -->
          <li th:each="page : ${#numbers.sequence(0, products.totalPages - 1)}"
              class="page-item"
              th:classappend="${page == products.number} ? 'active' : ''">
            <a class="page-link"
               th:href="@{/category/{title}(title=${category.title}, page=${page})}"
               th:text="${page + 1}">1</a>
          </li>

          <!-- Следующая страница -->
          <li class="page-item" th:classappend="${products.last} ? 'disabled' : ''">
            <a class="page-link"
               th:href="@{/category/{title}(title=${category.title}, page=${products.number + 1})}">
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>

          <!-- Последняя страница -->
          <li class="page-item" th:classappend="${products.last} ? 'disabled' : ''">
            <a class="page-link"
               th:href="@{/category/{title}(title=${category.title}, page=${products.totalPages - 1})}">
              <i class="bi bi-chevron-double-right"></i>
            </a>
          </li>
        </ul>
      </nav>

      <div class="text-center text-muted">
        Страница <span th:text="${products.number + 1}">1</span> из
        <span th:text="${products.totalPages}">1</span>
      </div>
    </div>
  </div>
</main>

<div th:replace="fragments/footer :: footer"></div>

<script>
  function addToCart(button) {
    button.innerHTML = '<i class="bi bi-check"></i> Добавлено';
    button.classList.remove('btn-primary');
    button.classList.add('btn-success');
    button.disabled = true;

    // Здесь будет AJAX запрос для добавления в корзину
    setTimeout(() => {
      button.innerHTML = '<i class="bi bi-cart-plus"></i> В корзину';
      button.classList.remove('btn-success');
      button.classList.add('btn-primary');
      button.disabled = false;
    }, 2000);
  }
</script>
</body>
</html>